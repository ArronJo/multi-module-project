<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CycloneDX BOM Viewer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; padding: 2rem; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 0.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; }
        .header h1 { font-size: 2rem; margin-bottom: 0.5rem; }
        .header .meta { opacity: 0.9; font-size: 0.875rem; }
        .upload-section { padding: 1.5rem; text-align: center; border-bottom: 1px solid #e0e0e0; background: #f9fafb; }
        .upload-btn { background: #667eea; color: white; padding: 0.5rem 1.5rem; border: none; border-radius: 0.25rem; cursor: pointer; font-size: 0.875rem; transition: background 0.3s; }
        .upload-btn:hover { background: #5568d3; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; padding: 2rem; background: #f9fafb; }
        .stat-card { background: white; padding: 1.5rem; border-radius: 0.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .stat-card .label { color: #6b7280; font-size: 0.875rem; margin-bottom: 0.5rem; }
        .stat-card .value { color: #1f2937; font-size: 2rem; font-weight: bold; }
        .content { padding: 2rem; }
        .search-box { margin-bottom: 1.5rem; }
        .search-box input { width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 0.25rem; font-size: 1rem; }
        .component-list { display: grid; gap: 1rem; }
        .component-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem; }
        .component-name { font-size: 1.125rem; font-weight: 600; color: #1f2937; word-break: break-word; flex: 1; }
        .component-version { background: #667eea; color: white; padding: 0.25rem 0.75rem; border-radius: 0.25rem; font-size: 0.875rem; white-space: nowrap; margin-left: 1rem; }
        .component-details { display: grid; gap: 0.5rem; font-size: 0.875rem; color: #6b7280; }
        .detail-row { display: flex; gap: 0.5rem; }
        .detail-label { font-weight: 600; min-width: 100px; }
        .detail-value { word-break: break-all; }
        .license-badge { display: inline-block; background: #10b981; color: white; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; margin-right: 0.25rem; }
        .hidden { display: none; }
        .data-source { padding: 0.5rem 1rem; background: #eff6ff; border-left: 3px solid #3b82f6; margin: 1rem 2rem; font-size: 0.875rem; color: #1e40af; }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üì¶ CycloneDX BOM Viewer</h1>
        <div class="meta" id="bomMeta">Loading...</div>
    </div>

    <div class="upload-section hidden" id="uploadSection">
        <input type="file" id="fileInput" accept=".json" style="display: none;">
        <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
            üìÅ Îã§Î•∏ BOM ÌååÏùº Î∂àÎü¨Ïò§Í∏∞
        </button>
    </div>

    <div class="data-source hidden" id="dataSource"></div>

    <div class="stats" id="statsSection">
        <div class="stat-card">
            <div class="label">Ï¥ù Ïª¥Ìè¨ÎÑåÌä∏</div>
            <div class="value" id="totalComponents">0</div>
        </div>
        <div class="stat-card">
            <div class="label">ÎùºÏù¥Î∏åÎü¨Î¶¨</div>
            <div class="value" id="libraryCount">0</div>
        </div>
        <div class="stat-card">
            <div class="label">ÎùºÏù¥ÏÑºÏä§ Ïàò</div>
            <div class="value" id="licenseCount">0</div>
        </div>
        <div class="stat-card">
            <div class="label">BOM Î≤ÑÏ†Ñ</div>
            <div class="value" id="bomVersion">-</div>
        </div>
    </div>

    <div class="content" id="contentSection">
        <div class="search-box">
            <label for="searchInput"></label><input type="text" id="searchInput" placeholder="üîç Ïª¥Ìè¨ÎÑåÌä∏ Í≤ÄÏÉâ (Ïù¥Î¶Ñ, Í∑∏Î£π, Î≤ÑÏ†Ñ)...">
        </div>
        <div class="component-list" id="componentList"></div>
    </div>
</div>

<script>
    // ÏûÑÎ≤†ÎìúÎêú BOM Îç∞Ïù¥ÌÑ∞ (GradleÏóêÏÑú Ï£ºÏûÖÎê®)
    const embeddedBomData = "/*BOM_DATA_PLACEHOLDER*/";

    let bomData = null;
    let allComponents = [];

    document.getElementById('fileInput').addEventListener('change', handleFileSelect);
    document.getElementById('searchInput').addEventListener('input', handleSearch);

    async function init() {
        // 1. ÏûÑÎ≤†ÎìúÎêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÎäîÏßÄ ÌôïÏù∏
        if (embeddedBomData && typeof embeddedBomData === 'object') {
            bomData = embeddedBomData;
            showDataSource('‚úÖ ÏûÑÎ≤†ÎìúÎêú BOM Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö© (Gradle ÎπåÎìú Ïãú ÏÉùÏÑ±)');
            displayBOM();
            document.getElementById('uploadSection').classList.remove('hidden');
            return;
        }

        // 2. ÏûÑÎ≤†Îìú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ ÌååÏùº Î°úÎìú ÏãúÎèÑ
        try {
            const response = await fetch('./cyclonedx/bom.json');
            if (response.ok) {
                bomData = await response.json();
                showDataSource('‚úÖ Ïô∏Î∂Ä BOM ÌååÏùº Î°úÎìú (./cyclonedx/bom.json)');
                displayBOM();
                document.getElementById('uploadSection').classList.remove('hidden');
                return;
            }
        } catch (error) {
            console.log('Ïô∏Î∂Ä ÌååÏùº Î°úÎìú Ïã§Ìå®:', error);
        }

        // 3. Î™®Îì† Î∞©Î≤ï Ïã§Ìå® Ïãú ÏàòÎèô ÏóÖÎ°úÎìú ÏïàÎÇ¥
        showDataSource('‚ö†Ô∏è BOM Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§. ÌååÏùºÏùÑ ÏàòÎèôÏúºÎ°ú ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.');
        document.getElementById('uploadSection').classList.remove('hidden');
        document.getElementById('bomMeta').textContent = 'BOM ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌïòÏÑ∏Ïöî';
    }

    function showDataSource(message) {
        const dataSourceEl = document.getElementById('dataSource');
        dataSourceEl.textContent = message;
        dataSourceEl.classList.remove('hidden');
    }

    function handleFileSelect(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                bomData = JSON.parse(e.target.result);
                showDataSource(`‚úÖ ÏàòÎèô ÏóÖÎ°úÎìúÎêú ÌååÏùº ÏÇ¨Ïö© (${file.name})`);
                displayBOM();
            } catch (error) {
                alert('ÌååÏùº ÌååÏã± Ïò§Î•ò: ' + error.message);
            }
        };
        reader.readAsText(file);
    }

    function displayBOM() {
        if (!bomData) return;

        document.getElementById('bomMeta').textContent =
            `${bomData.metadata?.component?.name || 'Unknown Project'} - Spec Version: ${bomData.specVersion || 'Unknown'}`;

        allComponents = bomData.components || [];
        const licenses = new Set();
        allComponents.forEach(c => {
            if (c.licenses) {
                c.licenses.forEach(l => {
                    if (l.license?.id) licenses.add(l.license.id);
                    if (l.license?.name) licenses.add(l.license.name);
                });
            }
        });

        document.getElementById('totalComponents').textContent = allComponents.length;
        document.getElementById('libraryCount').textContent = allComponents.filter(c => c.type === 'library').length;
        document.getElementById('licenseCount').textContent = licenses.size;
        document.getElementById('bomVersion').textContent = bomData.version || '1';

        renderComponents(allComponents);
    }

    function renderComponents(components) {
        const listEl = document.getElementById('componentList');
        listEl.innerHTML = '';

        if (components.length === 0) {
            listEl.innerHTML = '<div style="text-align: center; padding: 2rem; color: #6b7280;">Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§.</div>';
            return;
        }

        components.forEach(component => {
            const card = document.createElement('div');
            card.className = 'component-card';

            const licenses = component.licenses?.map(l =>
                `<span class="license-badge">${l.license?.id || l.license?.name || 'Unknown'}</span>`
            ).join('') || '<span class="license-badge" style="background:#6b7280;">No License</span>';

            card.innerHTML = `
                    <div class="component-header">
                        <div class="component-name">${component.name || 'Unknown'}</div>
                        <div class="component-version">${component.version || 'Unknown'}</div>
                    </div>
                    <div class="component-details">
                        ${component.group ? `<div class="detail-row"><span class="detail-label">Í∑∏Î£π:</span><span class="detail-value">${component.group}</span></div>` : ''}
                        ${component.purl ? `<div class="detail-row"><span class="detail-label">PURL:</span><span class="detail-value">${component.purl}</span></div>` : ''}
                        <div class="detail-row"><span class="detail-label">ÌÉÄÏûÖ:</span><span class="detail-value">${component.type || 'Unknown'}</span></div>
                        <div class="detail-row"><span class="detail-label">ÎùºÏù¥ÏÑºÏä§:</span><span class="detail-value">${licenses}</span></div>
                        ${component.description ? `<div class="detail-row"><span class="detail-label">ÏÑ§Î™Ö:</span><span class="detail-value">${component.description}</span></div>` : ''}
                    </div>
                `;

            listEl.appendChild(card);
        });
    }

    function handleSearch(event) {
        const query = event.target.value.toLowerCase();
        const filtered = allComponents.filter(c =>
            (c.name?.toLowerCase().includes(query)) ||
            (c.group?.toLowerCase().includes(query)) ||
            (c.version?.toLowerCase().includes(query)) ||
            (c.purl?.toLowerCase().includes(query))
        );
        renderComponents(filtered);
    }

    window.addEventListener('load', init);
</script>
</body>
</html>
